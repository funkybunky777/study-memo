# 모의해킹 및 시큐어코딩 - 개요

## 모의해킹 점검 항목


| 분류 			| 수행내용 		| 비고 |
| :-----------	| :-------:		| :------:		|
|웹 어플리케이션 	| 사용자 인증 		| 인가된 사용자 여부 식별에 대한 취약점 점검 |
|| 사용자 세션관리 	| 유/무선 환경의 네트워크 세션, 쿠키 등에 대한 취약점 |
|| 암호화 및 전송 보안 	| 중요 정보 암호화 전송에 대한 취약점 점검 |
|| 접근제어 및 권한 	| 비정상적인 권한을 이용하여 접근할 수 있는 취약점 점검 |
|| 데이터 유효성 		| 입력변수 유효성 점검 및 악의적인 데이터 대응 관련 취약점 |
|| 웹 취약점 			| 웹 보안영역의 전반적인 문제점으로 인하여 발생하는 취약점 점검 |
|| 사용자 개인정보보호 	| 인가된 사용자 여부 식별에 대한 취약점 점검
|| 정보노출			| 배너정보 open port정보, 임시/백업 파일 등의 정보 획득
|| 권한 획득			| 취약점 계정/비밀번호, 취약한 버전의 서비스 등을 이용한 권한 획득 |

## 웹 모의전단

**웹 모의진단은 아래의 3가지 방식으로 접근하여 취약점 점검 가능**

### 1. 툴 진단

"웹 스캐너" 사용. 

* URL 수집 : 사전 정의된 태그정보를 통해, 사이트 구조를 수집하는 과정이며, 이를 통해 사이트의 디렉토리 및 페이지 구조를 파악하는 단계
* 취약점 점검 : URL수집을 통해 확인된 디렉토리 및 페이지에 사전 정의된 패턴을 전송하여 취약점을 판단하는 단계

### 2. 모의진단

사이트의 메뉴를 추적하면서 로그인 페이지, 게시판 등에서 발생될 수 있는 취약점을 확인하는 방법, 툴 진단에 확인된 취약점을 검증하거나 분석이 불가능한 부분을 점검하는 과정

| 사이트 구조		| 기능			| 점검목록		|
|:------		| :-----		| :-----	|
| 로그인			| 계정 및 암호 입력	| Brute Force 공격, SQL Injection, 쿠키변조 등 |
| 계정 및 암호찾기 	| 계정 및 이메일 등 입력	| SQL Injection 등 |
| 회원가입			| 가입정보 입력 및 전송	| 중요정보 노출 등(전송 시 HTTP를 통한 계정, 암호, 주민번호의 편문전송)	|
| 회사소개			| HTML 링크		| 백업파일 노출 등	|
| 공지사항			| 게시판 - 글 읽기만 제공	| 파라미터변조, XSS 등 |
| 현장소식			| 게시판 - 글 읽기만 제공	| 파라미터변조, XSS 등 |
| Q&A			| 게시판 - 글쓰기, 파일 업로드 	| 파일 업로드, XSS, 파라미터 변조 등 |


### 3. 소스진단

소스코드를 분석하여 취약점이 발생가능한 위치를 확인하는 기법, 상용 툴을 통해 확인된 결과를 점검자가 검증하여 정상적인 탐지 혹은 비정상적인 탐지를 분류하는 작업을 수행

## 진단방법의 장단점

| 점검방법 	| 		장점		| 	단점		|
|:-------:	||
| 웹 스캐너	| 육안으로 검증가능한 취약점을 제공	| 구조분석이 디ㅗ지 않는 링크 등은 탐지불가 및 오탐 등으로 인해 재검증이 요구됨 |
|  모의진단 	| 웹 스캐너에서 탐지하지 못하는 부분을 상세하게 진단함 | 점검자의 기술적인 수준에 따라 탐지편차가 있음 |
| 소스진단 	| 웹 스캐너 및 모의진단에 비해 광범위한 취약점 탐지범위를 제공함 | 오탐 등으로 인해 점검자의 재검증이 요구됨 |

### OWASP 2013

| 분류		| 설명						|
|||
| A1 - Injection | SQL 삽입, 명령어 삽입, LDAP 삽입과 같은 취약점이 포함되며, 주요 원인은 신뢰할 수 없는 외부 값에 의해 발생되며 명령어 실행 또는 접근이 불가한 데이터에 대한 접근 등의 취약점이 발생 |
| A2 - Broken Authentication and Session Management | 인증과 세션관리와 관련된 어플리케이션의 비정상적인 동작으로 인해 패스워드, 키, 세션토큰 및 사용자 도용과 같은 취약점이 발생 |
| A4 - XSS 	| 신뢰할 수 없는 외부 값을 적절한 검증 없이 웹 브라우저로 전송하는 경우 발생되는 취작점으로, 사용자 세션을 가로채거나, 홈페이지 변조, 악의적인 사이트 이동 등으 ㅣ취약점이 발생 |
| A5 - Security Misconfiguration | 어플리케이션, 프레임워크, 어플리케이션서버, 데이터베이스서버, 플랫폼 등에 보안설정을 적절하게 설정하고, 최적화된 값으로 유지해야함 |
| A6 - Sensitive Data Exposure 	| 데이터저장 시 암호화 및 데이터 전송시에도 SSL 등을 이용해야함 |
| A7 - Missing Function Level Access Control | 가상적으로는 UI에서 보여지는 특정기능을 수행 전, 기능접근제한권한을 검증해야하나, 어플리케이션은 각 기능에 대한 접근 시 동일한 접근통제 검사 수행이 요구된다. <br> 적절하게 수행되지 않는 경우 공격자는 비인가된 기능에 접근하기 위해, 정상적인 요청을 변조시도 할 수 있다. |
| A8 - CSRF | 로그인된 피해자의 웹 브라우저를 통해, 세션쿠키 및 기타 다른 인증정보가 포함된 변조된 HTTP 요청을 전송시켜, 정상적인 요청처럼 보이게 하는 기법으로 타인 물품정보 취득, 사이트 글 변조 등의 취약점이 발생된다. |
| A9 - Using Components with Known Vulnerabilities | 슈퍼유저권한으로 운영되는 취약한 라이브러리, 프레임워크 및 기타 다른 소프트웨어 모듈로 인해 데이터유실 및 서버 구너한획득과 같은 취약성이 발생된다. |
| A10 - Unvaildated Redirects and Forwards | 웹 어플리케이션에 접속한 사용자를 다른 페이지로 분기시키는 경우, 피싱, 악성코드 사이트 등으로 접속되는 취약점을 의미 |

### KISA 행정기관 사이버침해 대응능력 진단 용역과제 제안 요청서 - Black BOX

### 안행부 시큐어코딩 43개 점검 항목 - White Box


# 모의해킹

## 1. SQL Injection

* **SQL INJECTION은 웹 어플리케이션에서 데이터베이스로 전달되는 SQL 뭐리 값을 변조 및 삽입하여 비정상적인 방법으로 데이터베이스에 접근하는 공격기법을 의미한다.<br/>이러한 공격을 통해 발생될 수 있는 취약점은 인증우회(계정 및 암호없이 로그인), 시스템 명령어 삽입(저장 프로시저를 악용한 OS 명령어 삽입 등), 웹쉘 생성 등이 있다.**

* **python SQLAlchemy에서는 raw SQL을 사용하지 않는다면 기본적으로 quoted 되어 SQL Injection이 불가하다.**

### 1-1 SQL Injection 유형

#### 1.1.1 논리적에러를 이용하는 SQL Injection

or 1=1 등의 논리적 에러를 발생시킬 수 있는 패턴을 이용한 인증우회 기법이며, 특히 에러가 발생되는 사이트에서는 에러정보를 이용하여 데이터베이스 및 쿼리구조 등의 정보를 추측할 수 있다.

`SELECT * FROM Users WHERE Username='$username' AND Password='$password'`

외부에서 입력될 수 있는 계정($username)과 암호($password)에 참 조건(or 1=1)을 수행하는 문장을 삽입하여 계정과 암호 없이도 로그인 우회가 가능할 것이다.

`SELECT * FROM Users WHERE Username='1' OR '1' = '1' AND Password='1' OR '1' = '1'`

이외에도 비슷한 다양한 패턴을 통해 우회공격 시도가 가능한다.

#### 1.1.2 두 개 이상의 쿼리를 이용하는 Union SQL Injection

UNION은 2개 이상의 쿼리를 요청하여 결과를 얻는 SQL 연산자이며, 공격자는 이를 악용하여 원래의 요청에 한 개의 추가 쿼리를 삽입하여 정보를 얻어내는 방식이다. 

`http://www.site.com/news.php?id=5 union all select 1, table_name,3 from information_schema.tables`

#### 1.1.3 쿼리 가능여부를 이용하는 Blind SQL Injection

악의적인 문자열 삽입 대신 쿼리 결과에 따라 정보를 취득하는 기법
SQL Injection 공격이 수행되었는지 아닌지 판별할 수 있다.

`http://www.xxx.com/page.php?id=5 and 1=1`

`http://www.xxx.com/page.php?id=5 and 1=2`

#### 1.1.4 저장 프로시저를 이용하는 Stored Procedure SQL Injection

저장 프로시저는 운영상 편이를 위해 만들어둔 SQL 집합형태이며, 특히 MS SQL에서 사용할 수 있는 xp_cmdshell은 윈도우 명령어를 실행하도록 역할을 제공하기 때문에 자주 악용되는 저장 프로시저 중의 하나이다. 

#### 1.1.5 타임기반의 Blind SQL Injection
쿼리 결과를 특정시간만큼 지연시키는 방법을 이용하는 기법으로, Blind 기법과 마찬가지로 에러가 발생되지 않는 조건에서 사용할 수 있는 기법이다.
Mysql에서 SLEEP() 함수를 이용하여  5초 후에 쿼리결과를 얻도록 공격문자열을 삽입하였다. 만약 5초 후에 쿼리 결과가 화면에 출력된다면 취약점이 있다고 판단할 수 있다.

`http://testphp.vulnweb.co/listproducts.php?cat=1 AND SLEEP(5)`

#### 1.1.6 에러 기반의 SQL Injection

GET, POST 요청 필드, HTTP헤더 값, 쿠키값 등에 특수문자(싱글쿼트(') 혹은 세미콜론(;)) 삽입 시, SQL 에러가 발생된다면 취약점이 있다고 판단할 수 있을 것이다.


### 1-2 사례 분석

#### 1.2.1 게시판 목록에 대한 공격

쿼리 가능여부를 확인하는 Blind SQL Injection 기법을 설명하고 잇으며, 게시판 쿼리 결과의 보여짐에 따라 취약점을 확인할 수 있다.


### 자동화

자동화 툴 **[Paros](http://elwlsek.tistory.com/50)** 

Paros로 전체적으로 취약점 점검을 하고.
SQL Injection은 sqlmap 툴을 통해 상세하게 점검한다.
[sqlmap](https://github.com/sqlmapproject/sqlmap.git)





<br><br><br><br><br><br><br>

